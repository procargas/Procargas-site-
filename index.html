<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Curso com Certificado + QR Code</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
  .lesson { margin-bottom: 10px; }
  label { cursor: pointer; }
  #totalTime { font-weight: bold; margin-top: 15px; }
  button { margin-top: 20px; padding: 10px 20px; font-size: 16px; cursor: pointer; }
</style>
</head>
<body>

<h1>Curso: Programação em JavaScript</h1>

<div id="lessons">
  <div class="lesson">
    <input type="checkbox" id="lesson1" data-time="30" />
    <label for="lesson1">Aula 1 - Introdução (30 min)</label>
  </div>
  <div class="lesson">
    <input type="checkbox" id="lesson2" data-time="45" />
    <label for="lesson2">Aula 2 - Variáveis e Tipos (45 min)</label>
  </div>
  <div class="lesson">
    <input type="checkbox" id="lesson3" data-time="40" />
    <label for="lesson3">Aula 3 - Funções (40 min)</label>
  </div>
</div>

<div id="totalTime">Tempo total estimado assistido: 0 min</div>

<button id="generateCert">Gerar Certificado PDF</button>

<!-- Div oculta para gerar o QR code -->
<div id="qr_temp" style="display:none;"></div>

<script>
  const lessons = document.querySelectorAll('#lessons input[type=checkbox]');
  const totalTimeEl = document.getElementById('totalTime');

  function atualizarTempoTotal() {
    let total = 0;
    lessons.forEach(l => {
      if (l.checked) total += Number(l.dataset.time);
    });
    totalTimeEl.textContent = `Tempo total estimado assistido: ${total} min`;
    return total;
  }

  lessons.forEach(l => l.addEventListener('change', atualizarTempoTotal));

  async function generateCertificatePDF() {
    const user = { id: 123, name: "João Silva", email: "joao@email.com" };
    const course = { id: 456, title: "Programação em JavaScript" };
    const { jsPDF } = window.jspdf;

    // Gera QR code com link de validação (exemplo)
    const qrContainer = document.getElementById('qr_temp');
    qrContainer.innerHTML = '';
    new QRCode(qrContainer, {
      text: `https://seusite.com/validar?user=${user.id}&curso=${course.id}`,
      width: 100,
      height: 100,
      colorDark: "#000000",
      colorLight: "#ffffff",
      correctLevel: QRCode.CorrectLevel.H
    });

    // Aguarda a geração do QR code
    await new Promise(r => setTimeout(r, 300));

    const img = qrContainer.querySelector('img').src;

    const doc = new jsPDF({ orientation: 'landscape', unit: 'pt', format: 'a4' });
    const width = doc.internal.pageSize.getWidth();
    const height = doc.internal.pageSize.getHeight();

    doc.setFillColor(13,13,13);
    doc.rect(0, 0, width, height, 'F');

    doc.setTextColor(255, 215, 0);
    doc.setFontSize(28);
    doc.text("Certificado de Conclusão", width/2, 110, { align: 'center' });

    doc.setTextColor(255,255,255);
    doc.setFontSize(16);
    doc.text(course.title, width/2, 160, { align: 'center' });

    doc.setFontSize(12);
    doc.text(`Certificamos que ${user.name} (${user.email}) concluiu o curso "${course.title}".`, width/2, 200, { align: 'center' });

    doc.text(`Data: ${new Date().toLocaleDateString()}`, width/2, 230, { align: 'center' });

    // Inserir QR Code na parte inferior central do certificado
    const qrSize = 80;
    doc.addImage(img, 'PNG', width/2 - qrSize/2, height - qrSize - 40, qrSize, qrSize);

    doc.setFontSize(10);
    doc.text('Escaneie o QR para verificar este certificado online.', width/2, height - 20, { align: 'center' });

    const filename = `${course.title.replace(/\s+/g,'_')}_certificado_${user.name.replace(/\s+/g,'_')}.pdf`;
    doc.save(filename);
  }

  document.getElementById('generateCert').addEventListener('click', generateCertificatePDF);

  // Inicializa o tempo total
  atualizarTempoTotal();
</script>

</body>
</html>
